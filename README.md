# svelte-adapter-deno

[Adapter](https://kit.svelte.dev/docs#adapters) for SvelteKit apps that generates a standalone Deno server.

## Usage

Install with `npm i -D svelte-adapter-deno`, then add the adapter to your `svelte.config.js`:

```js
// svelte.config.js
import adapter from 'svelte-adapter-deno';

export default {
  kit: {
    adapter: adapter({
      // default options are shown
      out: 'build',
      deps: './deps.ts' // (relative to adapter-deno package)
    })
  }
};
```

After building the server (`npm run build`), use the following command to start:

```sh
$ deno run --allow-env --allow-read --allow-net --config tsconfig.deno.json path/to/build/index.js
```

The server needs at least the following permissions to run:

- `allow-env` - allow environment access, to support runtime configuration via runtime variables (can be further restricted to include just the necessary variables)
- `allow-read` - allow file system read access (can be further restricted to include just the necessary directories)
- `allow-net` - allow network access (can be further restricted to include just the necessary domains)

Additionally, a tsconfig.json should be specified to support upstream dependencies, which currently need `"allowSyntheticDefaultImports": true` in the typescript compiler options.
An example is included in this package, which should be accessible at `node_modules/svelte-adapter-deno/tsconfig.deno.json`:

```sh
$ deno run --allow-env --allow-read --allow-net -c node_modules/svelte-adapter-deno/tsconfig.deno.json build/index.js
```

It fails the first time it runs, but should work correctly afterwards.

## Options

### out

The directory to build the server to. It defaults to `build` â€” i.e. `deno run --allow-env --allow-read --allow-net build/server.js` would start the server locally after it has been created.

### precompress

Enables precompressing using gzip and brotli for assets and prerendered pages. It defaults to `false`.

### deps

The file re-exporting external runtime dependencies (`deps.ts` by convention in Deno). It defaults to the `deps.ts` included in the package.

## Environment variables

By default, the server will accept connections on `0.0.0.0` using port 3000. These can be customised with the `PORT` and `HOST` environment variables:

```
HOST=127.0.0.1 PORT=4000 deno run --allow-env --allow-read --allow-net build/server.js
```

You can specify different environment variables if necessary using the `env` option.

## Advanced Configuration

### esbuild

As an escape hatch, you may optionally specify a function which will receive the final esbuild options generated by this adapter and returns a modified esbuild configuration. The result of this function will be passed as-is to esbuild. The function can be async.

For example, you may wish to add a plugin:

```js
adapterDeno({
  esbuild(defaultOptions) {
    return {
      ...defaultOptions,
      plugins: []
    };
  }
});
```

The default options for this version are as follows:

```js
{
  entryPoints: ['.svelte-kit/deno/index.js'],
  outfile: 'pathTo/index.js',
  bundle: true,
  format: 'esm',
  platform: 'neutral',
  define: {
    APP_DIR: `"/${config.kit.appDir}/"`
  },
  sourcemap: 'external'
}
```

## License

[MIT](LICENSE)
